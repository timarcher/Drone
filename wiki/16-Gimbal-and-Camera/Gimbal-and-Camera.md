This page contains details on setting up the Gremsy T7 Gimbal, a Sony a6500 Camera, and AirPixel Air Commander on the drone.

# YouTube Video
- [Hexacopter Drone Build Project – Part 16 Gimbal and Camera](https://youtu.be/ZaLEz2Q5GR8)

# Notes
- I replaced the stock 12mm payload carbon fiber tubes that came with the drone with longer 330mm ones from Amazon.
- I bought a longer 6-Pin JST-GH Twisted Pair - MRC0212 - 1000mm length cable from 3DR in order to make the serial connection from the gimbal to the Kore carrier board. Its a 6 pin connector and wire designed for I2C, but I removed 3 wires and swapped TX/RX on one end to make it work for the gimbal.
- The gimbal serial connection gets connected to the Telemetry 2 port on the Kore carrier board. See [this page for the wiring diagram](https://ardupilot.org/copter/docs/common-gremsy-pixyu-gimbal.html). We change this to a baud rate of 921,600 per the Air Commander documentation in ArudPilot by setting SERIAL2_BAUD = 921.
  - Set your ArduPilot parameters as defined under the section Parameters - Gremsy T7 Gimbal in the [ArduPilot Configuration](../ArduPilot-Config/ArduPilot-Config.md#) wiki page.
- Gremsy Gimbal Configuration
  - Ensure you load the latest firmware, 7.7.1 or later! Download from https://github.com/Gremsy/T7-Firmware/releases
    - NOTE: Gyro MUST be calibrated after upgrading completely.
      Open gTune --> SETTINGS --> GYRO --> CALIBRATE
      NOTE: Users should load the recommended gimbal parameters and perform an AUTO-TUNE process.
      Open gTune --> SETTINGS --> STIFFNESS --> AUTOTUNE
  - Tuning the stiffness: Increase the stiffness setting 5-10 points at a time until oscillation appears then reduce 5 points until oscillation subsides. Slowly increase this setting until you feel an oscillation in the tilt axis, then reduce the setting until the oscillation subsides.
    - I have my stiffness settings at: Tilt 25, Roll 45, Pan 45. Gyro Filter 2, and Output Filter 3
  - In the Gremsy GTuneDesktop app, change these options:
    - Settings -> Controls -> Mavlink - Set to enabled
      - Configure COM2 baudrate to 921600bps (used for connection to Cube)
      - Configure COM4 baudrate to 230400bps (used for Air Commander ENTIRE connection)
    - Settings -> Rotation - I set Tilt up to -20. I didnt want it to be able to tilt up a bunch.
    - Settings -> Follow - Change toggle swith to Pan. Set Speed to 30 so the gimbal yaw will follow the drone yaw faster.
    - Also go to the settings button in top left under mode, and unselect the "Reduce Drift by Drone" option, Pan Axis will be disabled.
- Sony A6500 Camera Configuration
  - Enable RemoteCtrl function in the Camera menu for the Air Commander IR light to be able to control the menu.
    - Camera Menu -> Setup (toolbox icon) -> Setup4 screen -> Scroll to the Remote Ctrl setting and make sure it’s set to On.
  - Turn the camera USB mode to the appropriate mode:
    - MASS STORAGE mode is used for geotagging. This mode prevents you from controlling the cameras ISO, Shutter Speed and Aperture. Use this for mapping type of work.
      - Camera Menu -> Setup (toolbox icon) -> Setup4 screen -> USB Connection. Set to Mass Storage and confirm OK.
    - PC REMOTE mode is prevents you from geotagging, but you can control the camera's ISO, Shutter Speed and Aperture. Use this mode for photo and video work.
      - Camera Menu -> Setup (toolbox icon) -> Setup4 screen -> USB Connection. Set to PC Remote and confirm OK.
      - You will also need the Air Commander Entire to not be in Direct Exif Geotagging mode for this to work. (Enable GeoTagging via MENU -> Logging mode-> Direct EXIF (or SD card))
    - If you want to have BOTH geotagging AND camera control, then you need to setup the camera in mass storage mode and configure [wifi for camera control on the Air Commander](https://airpixel.cz/docs/wifi-for-camera-control/). This connected on my A6500 Camera, but it did not work as advertised...Try at your will, but it may not work as you expect.
      - To do this, in the camera enable wifi remote control: MENU → (Application) → [Application List] → [Smart Remote Embedded].
      - Then, login to the Entire admin control. 
        - Switch Entire to WiFi control mode. Manage Entire to connect the Camera WiFi hotspot:MENU -> WiFi connection
        - Select first empty slot
        - Click to New Scan and wait  until scan is not ready
        - From drop down list selelct camera WiFi hotspot
        - Write down password from the camera
        - Click to Connect
        - Entire will connect the camera. During camera connection, Entire will disable own hotspot, so you’ll be disconnected. During connection Entire blinks quickly Blue/Green.
        - Once connection is done, Entire will go Blue or Green, then you can connect back from your phone or PC.
        - You can also add the "Sony Imagine Edge" mobile app to your phone and connect to your camera.
  - Enable Info Display on the Camera HDMI Output
    - Camera Menu -> Setup (toolbox icon) -> Setup4 screen -> HDMI. Change Info Display to On.
  - Disable AutoReview
    - Camera Menu -> Camera Settings 2 -> Auto Review. Change to off.
  - Change Type of Image Captured
    - Camera Menu -> Camera Settings 1 -> Quality. Change to Raw + JPEG for both RAW and JPG files, or Extra Fine for best JPG only quality.
  - Exit the menu after changing the above. Be sure to physically power off the camera using its own power switch on the top of the camera. If you dont, the settings changed above will not save.
  - To format the memory card, go to Camera Menu -> Setup (toolbox icon) -> Setup6 screen -> Format
  - Some notes on Camera exposure settings:
    - Higher focal length (ie 50mm vs 35mm) is more detail, less field of view. Lower focal length is higher field of view and less detail.
    - Settings for mapping are ISO 200, shutter speed 1/1000, and aperture f/2.8
- AirPixel Air Commander Entire R3 Configuration:
  - Connect to its WiFi hotspot from your PC
  - http://entire/ or http://192.168.10.1/
  - Open ENTIRE’s MENU web page and set UNI-C port to
    - MavLink mode
    - 230400 bps
  - Enable GeoTagging via MENU -> Logging mode-> Direct EXIF (or SD card)
  - Enable HotShoe capturing via MENU -> Capture detection -> Hotshoe sync
  - Set Time Zone to your local time zone
    - MENU -> Settings -> Time Zone Offset
  - Set other options for Geotagging
    - MENU -> Settings
      - XMP Geotagging Section
        - Set geotag roll/pitch/yaw to on
        - Set geotag gps accuracy to on
    - TEXT Log Features Section
      - Append UTC Time to on
      - Append FIX type and HDOP to on
      - Append GPSAccuracy to on
      - Append RangeFinder to on
  - Now you can also preview GPS data and gimbal angles in the Entire’s GUI
    - MENU -> Settings -> GPS Data Preview
    - Data shown in the preview are updated online and should react to gimbal movements
  - Enable slow zoom for the Sony Zoom Lens
    - MENU -> Miscellaneous -> SONY Options -> Use Slower Zooming (set to checked)
  - Have the Air Commander Restart Camera After It Initializes. I noticed that if I dont do this, there are times where the Air Commander was unable to control the camera after first powering on the drone. (I am on the fence if this actually helps. I currently have this disabled.)
    -  MENU -> Miscellaneous -> SONY Options -> Send Power Toggle After Start-Up (set to checked)
  -  MENU -> Miscellaneous -> Dont Reconnect USB After Photo
     -  I set this to checked per the docs at https://airpixel.cz/docs/sony-camera-control/
  - Do a self test
    - MENU -> Configuration Test
- To control the gimbal on the Herelink controller:
  - Ensure you install the latest QGroundControl release for the Herelink: [QGroundControl Herelink Releases](https://github.com/CubePilot/qgroundcontrol-herelink/releases)
  - Then follow [these instructions on Youtube](https://www.youtube.com/watch?v=a-cLzYD7HBk&t=43s) to install the custom APK file for QGroundControl on the Herelink.
  - Also install [AirPixel Air Commander MavCam for HereLink](https://airpixel.cz/docs/herelink-camera-control/)
- HereLink QGroundControl Setup
  - Tap on the gimbal settings in top right menu.
  - Check Enable on Screen Camera Control
  - Set Control Type to Click to Point
  - Check show gimbal Azimuth in map
  - Uncheck show gimbal Azimuth instead of local yaw on top toolbar indicator
- AirPixel Air Commander MavCam for HereLink Setup
  - Swipe up on the widget to see the Control Menu
  - Swipe right on the widget for Settings
    - Check HW Photo Button
    - Check HW Video Button
    - Check HW Wheel
    - Check Joystick
  - Press the GTG button in MavCam widget (for Geotagging control). Set Takeoff detection to enabled.
- Install the Air Commander Mission Planner Camera Controller Plugin
  - [Air Commander Mission Planner Camera Controller Plugin](https://airpixel.cz/docs/missionplanner-camera-control-plugin/)

# Supporting Materials
- [ArduPilot Configuration](../ArduPilot-Config/ArduPilot-Config.md) - This page contains a consolidated list of the all of the configuration done in ArduPilot throughout the videos.

# References 
- [Ardupilot to Gremsy HDMI Quick Release Wiring](https://ardupilot.org/copter/docs/common-gremsy-pixyu-gimbal.html)
- [Gremsy GTune Desktop Software](https://github.com/Gremsy/gTuneDesktop/releases)
- [Gremsy T7 Firmware Releases and Downloads](https://github.com/Gremsy/T7-Firmware/releases)
- [Gremsy T7 Firmware Upgrade Instructions](https://gremsy.com/support/product-support/series-gremsy-t-s/gremsy-t7/gremsy-t7-download)
- [AirPixel Air Commander Setup with Gremsy Gimbal](https://airpixel.cz/docs/gremsy-evo-installation-for-pixhawk/)
- [AirPixel Air Commander Sony Camera Control](https://airpixel.cz/docs/sony-camera-control/)
- [AirPixel Air Commander Using WiFi for camera control](https://airpixel.cz/docs/wifi-for-camera-control/)
- [AirPixel Air Commander MavCam for HereLink](https://airpixel.cz/docs/herelink-camera-control/)
- [AirPixel Air Commander Mission Planner Camera Control Plugin](https://airpixel.cz/docs/missionplanner-camera-control-plugin/)
- [AirPixel Air Commander Firmware Updates](https://airpixel.cz/docs/firmware-update/)
- [QGroundControl Herelink Releases](https://github.com/CubePilot/qgroundcontrol-herelink/releases)
- [PureThemal Mini Flir USB IR Camera Mount 3d Print](https://cults3d.com/en/3d-model/game/pure-thermal-mini-flir-usb-ir-camera-mount) - I had to scale this to 105% for it to fit the USB camera. I used this as the back, and the next file for the top.
- [Hard Enclosure for Purethermal Mini 3d Print](https://cults3d.com/en/3d-model/gadget/hard-enclosure-for-purethermal-mini) - I had to scale this to 105% for it to fit the USB camera. I used this as the front, and the prior file for the back.
- [PTGui](https://ptgui.com/) - software you can create high quality panoramas with.